# You need to set up Workload Identity Federation in your Google Cloud project in order to use this GitHub Actions definition: https://medium.com/p/3932dce678b8.
# And the secrets.GSA_ID needs to have the roles/artifactregistry.repoAdmin role in order push and delete container images.
name: open-pr
permissions:
  contents: read
  id-token: write
  pull-requests: write
on:
  pull_request:
env:
  ENVIRONMENT_ID: pr-${{ github.event.number }}
  IMAGE_NAME: ${{ secrets.REGISTRY_LOCATION }}-docker.pkg.dev/${{ secrets.PROJECT_ID }}/${{ secrets.REGISTRY_NAME }}/${{ vars.APP_NAME }}
  SCORE_COMPOSE_VERSION: 'latest'
  SCORE_HELM_VERSION: 'latest'
  SCORE_HUMANITEC_VERSION: 'latest'
jobs:
  build-run-test-push:
    runs-on: ubuntu-latest
    steps:
      - name: checkout code
        uses: actions/checkout@v3
      - name: build & run container
        run: |
          git log --format=%B -n 1 HEAD | head -n 1
          git log -1 --no-merges --pretty=%B
          ${{ github.event.head_commit.message }}
      